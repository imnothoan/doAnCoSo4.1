--- routes/community.routes.js.orig	2025-12-04 18:21:54.911344969 +0000
+++ routes/community.routes.js	2025-12-04 18:22:08.152536595 +0000
@@ -369,24 +369,50 @@
     if (!requiresApproval) {
       await recomputeCommunityMemberCount(communityId);
 
-      // Auto-add member to community chat conversation
+      // IMPROVED: Ensure community conversation exists and auto-add member
       try {
-        // Get or create community conversation
-        const { data: conv, error: convErr } = await supabase
+        let conversationId;
+        
+        // Try to get existing conversation
+        const { data: existingConv } = await supabase
           .from("conversations")
           .select("id")
           .eq("community_id", communityId)
           .single();
 
-        if (conv && conv.id) {
-          // Add member to conversation
+        if (existingConv) {
+          conversationId = existingConv.id;
+          console.log(`Found existing conversation ${conversationId} for community ${communityId}`);
+        } else {
+          // Create conversation for this community
+          const { data: newConv, error: convErr } = await supabase
+            .from("conversations")
+            .insert([{
+              type: "community",
+              community_id: communityId,
+              created_by: username, // The first member creates it
+            }])
+            .select("id")
+            .single();
+
+          if (convErr) {
+            console.error("Error creating community conversation:", convErr);
+          } else {
+            conversationId = newConv.id;
+            console.log(`Created community conversation ${conversationId} for community ${communityId}`);
+          }
+        }
+
+        // Add member to conversation_members
+        if (conversationId) {
           await supabase
             .from("conversation_members")
             .upsert(
-              [{ conversation_id: conv.id, username }],
+              [{ conversation_id: conversationId, username }],
               { onConflict: "conversation_id,username" }
             );
-          console.log(`Auto-added ${username} to community ${communityId} chat`);
+          
+          console.log(`Auto-added ${username} to community ${communityId} conversation ${conversationId}`);
         }
       } catch (chatErr) {
         console.error("Error adding member to community chat:", chatErr);
